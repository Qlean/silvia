package silvia

import (
	"database/sql"
	"fmt"
	"reflect"
	"testing"
	"time"

	"github.com/abh/geoip"
)

var snowplowStrings = []string{}

var transformResultsSnowplow = []struct {
	title    string
	request  string
	expected map[string]interface{}
}{
	{
		`Test 0`,
		`{\x22ip_addr\x22:\x22213.24.135.133\x22,\x22time_local\x22:\x2230/Mar/2016:11:46:22 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-2\x22,\x22data\x22:[{\x22e\x22:\x22pv\x22,\x22url\x22:\x22https://qlean.ru/jobs/msk\x22,\x22page\x22:\x22\xD0\xA0\xD0\xB0\xD0\xB1\xD0\xBE\xD1\x82\xD0\xB0 \xD0\xB2 Qlean\x22,\x22refr\x22:\x22http://ok.ru/feed\x22,\x22tv\x22:\x22js-2.4.3\x22,\x22tna\x22:\x22cf\x22,\x22aid\x22:\x22qlean_web_app\x22,\x22p\x22:\x22web\x22,\x22tz\x22:\x22Asia/Baghdad\x22,\x22lang\x22:\x22ru\x22,\x22cs\x22:\x22UTF-8\x22,\x22f_pdf\x22:\x221\x22,\x22f_qt\x22:\x220\x22,\x22f_realp\x22:\x220\x22,\x22f_wma\x22:\x220\x22,\x22f_dir\x22:\x220\x22,\x22f_fla\x22:\x221\x22,\x22f_java\x22:\x220\x22,\x22f_gears\x22:\x220\x22,\x22f_ag\x22:\x220\x22,\x22res\x22:\x221600x900\x22,\x22cd\x22:\x2224\x22,\x22cookie\x22:\x221\x22,\x22eid\x22:\x22850ed957-9a2f-49e3-bb46-a33a5769298c\x22,\x22dtm\x22:\x221459352780283\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22data\x5C\x22:{\x5C\x22utm_source\x5C\x22:\x5C\x22mytarget\x5C\x22,\x5C\x22utm_medium\x5C\x22:\x5C\x22cpc\x5C\x22,\x5C\x22utm_campaign\x5C\x22:\x5C\x226198246\x5C\x22,\x5C\x22utm_content\x5C\x22:\x5C\x2220668308\x5C\x22,\x5C\x22utm_term\x5C\x22:null}}]}\x22,\x22vp\x22:\x221600x799\x22,\x22ds\x22:\x221583x2251\x22,\x22vid\x22:\x221\x22,\x22duid\x22:\x22d55f24aad0c5c781\x22,\x22fp\x22:\x224277557631\x22}]},\x22http_referer\x22:\x22https://qlean.ru/jobs/msk\x22,\x22http_user_agent\x22:\x22Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36\x22}`,
		map[string]interface{}{

			"Id":               int(0),
			"Aid":              sql.NullString{`qlean_web_app`, true},
			"Platform":         sql.NullString{`web`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-03-30T15:46:20Z"); return t }(),
			"Event":            sql.NullString{`pv`, true},
			"EventID":          sql.NullString{`850ed957-9a2f-49e3-bb46-a33a5769298c`, true},
			"VTracker":         sql.NullString{`js-2.4.3`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`213.24.135.133`, true},
			"UserFingerprint":  sql.NullString{`4277557631`, true},
			"DomainUserID":     sql.NullString{`d55f24aad0c5c781`, true},
			"VisitNum":         sql.NullInt64{int64(1), true},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`Russian Federation`, true},
			"PageURL":          sql.NullString{`https://qlean.ru/jobs/msk`, true},
			"PageTtile":        sql.NullString{`Работа в Qlean`, true},
			"PageReferrer":     sql.NullString{`http://ok.ru/feed`, true},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{`cpc`, true},
			"UtmSource":        sql.NullString{`mytarget`, true},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{`20668308`, true},
			"UtmCampaign":      sql.NullString{`6198246`, true},
			"Contexts":         sql.NullString{`{"utm_source":"mytarget","utm_medium":"cpc","utm_campaign":"6198246","utm_content":"20668308","utm_term":null}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{Valid: false},
			"Useragent":        sql.NullString{`Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.87 Safari/537.36`, true},
			"BrName":           sql.NullString{`Chrome`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`49.0.2623.87`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`AppleWebKit537.36`, true},
			"BrLang":           sql.NullString{`ru`, true},
			"BrPDF":            bool(true),
			"BrFlash":          bool(true),
			"BrJava":           bool(false),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(false),
			"BrCookies":        bool(true),
			"BrColorDepth":     sql.NullInt64{int64(24), true},
			"BrViewWidth":      int(1600),
			"BrViewHeight":     int(799),
			"OsName":           sql.NullString{`Windows 7`, true},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{`Asia/Baghdad`, true},
			"DvceType":         sql.NullString{`Windows`, true},
			"DvceIsMobile":     bool(false),
			"DvceScreenWidth":  int(1600),
			"DvceScreenHeight": int(900),
			"DocCharset":       sql.NullString{`UTF-8`, true},
			"DocWidth":         int(1583),
			"DocHeight":        int(1583),
		},
	},
	{
		`Test 1`,
		`{\x22ip_addr\x22:\x22185.13.47.142\x22,\x22time_local\x22:\x2215/Apr/2016:13:47:08 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-2\x22,\x22data\x22:[{\x22e\x22:\x22pv\x22,\x22url\x22:\x22https://qlean.ru/jobs/msk?utm_source=vk_cpc&utm_medium=dp&utm_campaign=msk_student\x22,\x22page\x22:\x22\xD0\xA0\xD0\xB0\xD0\xB1\xD0\xBE\xD1\x82\xD0\xB0 \xD0\xB2 Qlean\x22,\x22refr\x22:\x22https://vk.com/id330818047\x22,\x22tv\x22:\x22js-2.4.3\x22,\x22tna\x22:\x22cf\x22,\x22aid\x22:\x22qlean_web_app\x22,\x22p\x22:\x22web\x22,\x22tz\x22:\x22Asia/Baghdad\x22,\x22lang\x22:\x22ru\x22,\x22cs\x22:\x22UTF-8\x22,\x22f_pdf\x22:\x221\x22,\x22f_qt\x22:\x220\x22,\x22f_realp\x22:\x220\x22,\x22f_wma\x22:\x220\x22,\x22f_dir\x22:\x220\x22,\x22f_fla\x22:\x221\x22,\x22f_java\x22:\x220\x22,\x22f_gears\x22:\x220\x22,\x22f_ag\x22:\x220\x22,\x22res\x22:\x221920x1080\x22,\x22cd\x22:\x2224\x22,\x22cookie\x22:\x221\x22,\x22eid\x22:\x2265e44f15-2179-40aa-a100-fec9310875b8\x22,\x22dtm\x22:\x221460742426765\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22data\x5C\x22:{\x5C\x22utm_source\x5C\x22:\x5C\x22vk_cpc\x5C\x22,\x5C\x22utm_medium\x5C\x22:\x5C\x22dp\x5C\x22,\x5C\x22utm_campaign\x5C\x22:\x5C\x22msk_student\x5C\x22,\x5C\x22utm_content\x5C\x22:null,\x5C\x22utm_term\x5C\x22:null}}]}\x22,\x22vp\x22:\x221920x979\x22,\x22ds\x22:\x221903x2340\x22,\x22vid\x22:\x221\x22,\x22duid\x22:\x220b0f7c144db1a317\x22,\x22fp\x22:\x222365485884\x22}]},\x22http_referer\x22:\x22https://qlean.ru/jobs/msk?utm_source=vk_cpc&utm_medium=dp&utm_campaign=msk_student\x22,\x22http_user_agent\x22:\x22Mozilla/5.0 (Windows 10) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\x22}`,
		map[string]interface{}{
			"Id":               int(0),
			"Aid":              sql.NullString{`qlean_web_app`, true},
			"Platform":         sql.NullString{`web`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-04-15T17:47:06Z"); return t }(),
			"Event":            sql.NullString{`pv`, true},
			"EventID":          sql.NullString{`65e44f15-2179-40aa-a100-fec9310875b8`, true},
			"VTracker":         sql.NullString{`js-2.4.3`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`185.13.47.142`, true},
			"UserFingerprint":  sql.NullString{`2365485884`, true},
			"DomainUserID":     sql.NullString{`0b0f7c144db1a317`, true},
			"VisitNum":         sql.NullInt64{int64(1), true},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`Russian Federation`, true},
			"PageURL":          sql.NullString{`https://qlean.ru/jobs/msk?utm_source=vk_cpc&utm_medium=dp&utm_campaign=msk_student`, true},
			"PageTtile":        sql.NullString{`Работа в Qlean`, true},
			"PageReferrer":     sql.NullString{`https://vk.com/id330818047`, true},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{`dp`, true},
			"UtmSource":        sql.NullString{`vk_cpc`, true},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{Valid: false},
			"UtmCampaign":      sql.NullString{`msk_student`, true},
			"Contexts":         sql.NullString{`{"utm_source":"vk_cpc","utm_medium":"dp","utm_campaign":"msk_student","utm_content":null,"utm_term":null}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{Valid: false},
			"Useragent":        sql.NullString{`Mozilla/5.0 (Windows 10) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36`, true},
			"BrName":           sql.NullString{`Chrome`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`49.0.2623.112`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`AppleWebKit537.36`, true},
			"BrLang":           sql.NullString{`ru`, true},
			"BrPDF":            bool(true),
			"BrFlash":          bool(true),
			"BrJava":           bool(false),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(false),
			"BrCookies":        bool(true),
			"BrColorDepth":     sql.NullInt64{int64(24), true},
			"BrViewWidth":      int(1920),
			"BrViewHeight":     int(979),
			"OsName":           sql.NullString{`Windows 10`, true},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{`Asia/Baghdad`, true},
			"DvceType":         sql.NullString{`Windows`, true},
			"DvceIsMobile":     bool(false),
			"DvceScreenWidth":  int(1920),
			"DvceScreenHeight": int(1080),
			"DocCharset":       sql.NullString{`UTF-8`, true},
			"DocWidth":         int(1903),
			"DocHeight":        int(1903),
		},
	},
	{
		`Test 2`,
		`{\x22ip_addr\x22:\x2279.172.123.34\x22,\x22time_local\x22:\x2215/Apr/2016:13:47:11 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-2\x22,\x22data\x22:[{\x22e\x22:\x22pv\x22,\x22url\x22:\x22https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50&utm_content=21211259\x22,\x22page\x22:\x22\xD0\xA0\xD0\xB0\xD0\xB1\xD0\xBE\xD1\x82\xD0\xB0 \xD0\xB2 Qlean\x22,\x22tv\x22:\x22js-2.4.3\x22,\x22tna\x22:\x22cf\x22,\x22aid\x22:\x22qlean_web_app\x22,\x22p\x22:\x22web\x22,\x22tz\x22:\x22Europe/Minsk\x22,\x22lang\x22:\x22ru\x22,\x22cs\x22:\x22UTF-8\x22,\x22res\x22:\x22320x570\x22,\x22cd\x22:\x2232\x22,\x22cookie\x22:\x221\x22,\x22eid\x22:\x228e3684b8-cf83-447b-ae11-4a0cb69f9dae\x22,\x22dtm\x22:\x221460742437330\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22data\x5C\x22:{\x5C\x22utm_source\x5C\x22:\x5C\x22targetmail\x5C\x22,\x5C\x22utm_medium\x5C\x22:\x5C\x22dp\x5C\x22,\x5C\x22utm_campaign\x5C\x22:\x5C\x226335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50\x5C\x22,\x5C\x22utm_content\x5C\x22:\x5C\x2221211259\x5C\x22,\x5C\x22utm_term\x5C\x22:null}}]}\x22,\x22vp\x22:\x22320x488\x22,\x22ds\x22:\x22320x4354\x22,\x22vid\x22:\x221\x22,\x22duid\x22:\x22b8c090292086fde3\x22,\x22fp\x22:\x22856253825\x22}]},\x22http_referer\x22:\x22https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50&utm_content=21211259\x22,\x22http_user_agent\x22:\x22Mozilla/5.0 (Linux; Android 4.4.2; HUAWEI Y541-U02 Build/HUAWEIY541-U02) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.105 Mobile Safari/537.36\x22}`,
		map[string]interface{}{
			"Id":               int(0),
			"Aid":              sql.NullString{`qlean_web_app`, true},
			"Platform":         sql.NullString{`web`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-04-15T17:47:17Z"); return t }(),
			"Event":            sql.NullString{`pv`, true},
			"EventID":          sql.NullString{`8e3684b8-cf83-447b-ae11-4a0cb69f9dae`, true},
			"VTracker":         sql.NullString{`js-2.4.3`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`79.172.123.34`, true},
			"UserFingerprint":  sql.NullString{`856253825`, true},
			"DomainUserID":     sql.NullString{`b8c090292086fde3`, true},
			"VisitNum":         sql.NullInt64{int64(1), true},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`Russian Federation`, true},
			"PageURL":          sql.NullString{`https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50&utm_content=21211259`, true},
			"PageTtile":        sql.NullString{`Работа в Qlean`, true},
			"PageReferrer":     sql.NullString{Valid: false},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{`dp`, true},
			"UtmSource":        sql.NullString{`targetmail`, true},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{`21211259`, true},
			"UtmCampaign":      sql.NullString{`6335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50`, true},
			"Contexts":         sql.NullString{`{"utm_source":"targetmail","utm_medium":"dp","utm_campaign":"6335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50","utm_content":"21211259","utm_term":null}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{Valid: false},
			"Useragent":        sql.NullString{`Mozilla/5.0 (Linux; Android 4.4.2; HUAWEI Y541-U02 Build/HUAWEIY541-U02) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.105 Mobile Safari/537.36`, true},
			"BrName":           sql.NullString{`Chrome`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`49.0.2623.105`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`AppleWebKit537.36`, true},
			"BrLang":           sql.NullString{`ru`, true},
			"BrPDF":            bool(false),
			"BrFlash":          bool(false),
			"BrJava":           bool(false),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(false),
			"BrCookies":        bool(true),
			"BrColorDepth":     sql.NullInt64{int64(32), true},
			"BrViewWidth":      int(320),
			"BrViewHeight":     int(488),
			"OsName":           sql.NullString{`Android 4.4.2`, true},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{`Europe/Minsk`, true},
			"DvceType":         sql.NullString{`Linux`, true},
			"DvceIsMobile":     bool(true),
			"DvceScreenWidth":  int(320),
			"DvceScreenHeight": int(570),
			"DocCharset":       sql.NullString{`UTF-8`, true},
			"DocWidth":         int(320),
			"DocHeight":        int(320),
		},
	},
	{
		`Test 3`,
		`{\x22ip_addr\x22:\x22141.0.13.85\x22,\x22time_local\x22:\x2215/Apr/2016:13:47:11 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-2\x22,\x22data\x22:[{\x22e\x22:\x22pv\x22,\x22url\x22:\x22https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335523_Msk_Qlean_Jobs_Interests_No_AND_F_25-50&utm_content=21211215\x22,\x22page\x22:\x22\xD0\xA0\xD0\xB0\xD0\xB1\xD0\xBE\xD1\x82\xD0\xB0 \xD0\xB2 Qlean\x22,\x22tv\x22:\x22js-2.4.3\x22,\x22tna\x22:\x22cf\x22,\x22aid\x22:\x22qlean_web_app\x22,\x22p\x22:\x22web\x22,\x22tz\x22:\x22Asia/Baghdad\x22,\x22lang\x22:\x22ru\x22,\x22cs\x22:\x22utf-8\x22,\x22f_pdf\x22:\x220\x22,\x22f_qt\x22:\x220\x22,\x22f_realp\x22:\x220\x22,\x22f_wma\x22:\x220\x22,\x22f_dir\x22:\x220\x22,\x22f_fla\x22:\x220\x22,\x22f_java\x22:\x220\x22,\x22f_gears\x22:\x220\x22,\x22f_ag\x22:\x220\x22,\x22res\x22:\x22317x443\x22,\x22cd\x22:\x224\x22,\x22cookie\x22:\x221\x22,\x22eid\x22:\x226e007663-c251-4843-a1cf-e8b9de6039ea\x22,\x22dtm\x22:\x221460742431394\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22data\x5C\x22:{\x5C\x22utm_source\x5C\x22:\x5C\x22targetmail\x5C\x22,\x5C\x22utm_medium\x5C\x22:\x5C\x22dp\x5C\x22,\x5C\x22utm_campaign\x5C\x22:\x5C\x226335523_Msk_Qlean_Jobs_Interests_No_AND_F_25-50\x5C\x22,\x5C\x22utm_content\x5C\x22:\x5C\x2221211215\x5C\x22,\x5C\x22utm_term\x5C\x22:null}}]}\x22,\x22vp\x22:\x22318x3642\x22,\x22ds\x22:\x22318x3642\x22,\x22vid\x22:\x221\x22,\x22duid\x22:\x22608a01b2bf5f645c\x22,\x22fp\x22:\x222722198750\x22}]},\x22http_referer\x22:\x22https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335523_Msk_Qlean_Jobs_Interests_No_AND_F_25-50&utm_content=21211215\x22,\x22http_user_agent\x22:\x22Opera/9.80 (Android; Opera Mini/7.5.32193/37.8186; U; ru) Presto/2.12.423 Version/12.16\x22}`,
		map[string]interface{}{
			"Id":               int(0),
			"Aid":              sql.NullString{`qlean_web_app`, true},
			"Platform":         sql.NullString{`web`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-04-15T17:47:11Z"); return t }(),
			"Event":            sql.NullString{`pv`, true},
			"EventID":          sql.NullString{`6e007663-c251-4843-a1cf-e8b9de6039ea`, true},
			"VTracker":         sql.NullString{`js-2.4.3`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`141.0.13.85`, true},
			"UserFingerprint":  sql.NullString{`2722198750`, true},
			"DomainUserID":     sql.NullString{`608a01b2bf5f645c`, true},
			"VisitNum":         sql.NullInt64{int64(1), true},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`South Africa`, true},
			"PageURL":          sql.NullString{`https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335523_Msk_Qlean_Jobs_Interests_No_AND_F_25-50&utm_content=21211215`, true},
			"PageTtile":        sql.NullString{`Работа в Qlean`, true},
			"PageReferrer":     sql.NullString{Valid: false},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{`dp`, true},
			"UtmSource":        sql.NullString{`targetmail`, true},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{`21211215`, true},
			"UtmCampaign":      sql.NullString{`6335523_Msk_Qlean_Jobs_Interests_No_AND_F_25-50`, true},
			"Contexts":         sql.NullString{`{"utm_source":"targetmail","utm_medium":"dp","utm_campaign":"6335523_Msk_Qlean_Jobs_Interests_No_AND_F_25-50","utm_content":"21211215","utm_term":null}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{Valid: false},
			"Useragent":        sql.NullString{`Opera/9.80 (Android; Opera Mini/7.5.32193/37.8186; U; ru) Presto/2.12.423 Version/12.16`, true},
			"BrName":           sql.NullString{`Opera`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`9.80`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`Presto2.12.423`, true},
			"BrLang":           sql.NullString{`ru`, true},
			"BrPDF":            bool(false),
			"BrFlash":          bool(false),
			"BrJava":           bool(false),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(false),
			"BrCookies":        bool(true),
			"BrColorDepth":     sql.NullInt64{int64(4), true},
			"BrViewWidth":      int(318),
			"BrViewHeight":     int(3642),
			"OsName":           sql.NullString{`Opera Mini/7.5.32193/37.8186`, true},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{`Asia/Baghdad`, true},
			"DvceType":         sql.NullString{`Android`, true},
			"DvceIsMobile":     bool(true),
			"DvceScreenWidth":  int(317),
			"DvceScreenHeight": int(443),
			"DocCharset":       sql.NullString{`utf-8`, true},
			"DocWidth":         int(318),
			"DocHeight":        int(318),
		},
	},
	{
		`Test 4`,
		`{\x22ip_addr\x22:\x22109.252.206.94\x22,\x22time_local\x22:\x2215/Apr/2016:13:47:13 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-2\x22,\x22data\x22:[{\x22e\x22:\x22pv\x22,\x22url\x22:\x22https://qlean.ru/?promocode=utarget&utm_source=utargetWoman&utm_medium=clickunder&utm_campaign=1262\x22,\x22page\x22:\x22\xD0\xA3\xD0\xB1\xD0\xBE\xD1\x80\xD0\xBA\xD0\xB0 \xD0\xBA\xD0\xB2\xD0\xB0\xD1\x80\xD1\x82\xD0\xB8\xD1\x80 \xD0\xB2 \xD0\x9C\xD0\xBE\xD1\x81\xD0\xBA\xD0\xB2\xD0\xB5 \xE2\x80\x94 \xD0\xBD\xD0\xB5\xD0\xB4\xD0\xBE\xD1\x80\xD0\xBE\xD0\xB3\xD0\xB0\xD1\x8F \xD1\x83\xD0\xB1\xD0\xBE\xD1\x80\xD0\xBA\xD0\xB0 \xD0\xBA\xD0\xB2\xD0\xB0\xD1\x80\xD1\x82\xD0\xB8\xD1\x80\xD1\x8B \xE2\x80\x94 \xD0\x9A\xD0\xBB\xD0\xB8\xD0\xBD\xD0\xB8\xD0\xBD\xD0\xB3\xD0\xBE\xD0\xB2\xD0\xB0\xD1\x8F \xD0\xBA\xD0\xBE\xD0\xBC\xD0\xBF\xD0\xB0\xD0\xBD\xD0\xB8\xD1\x8F Qlean.ru\x22,\x22refr\x22:\x22http://utarget.ru/goto/3175/fa0ac1ac16/\x22,\x22tv\x22:\x22js-2.4.3\x22,\x22tna\x22:\x22cf\x22,\x22aid\x22:\x22qlean_web_app\x22,\x22p\x22:\x22web\x22,\x22tz\x22:\x22Asia/Baghdad\x22,\x22lang\x22:\x22ru\x22,\x22cs\x22:\x22UTF-8\x22,\x22f_pdf\x22:\x221\x22,\x22f_qt\x22:\x220\x22,\x22f_realp\x22:\x220\x22,\x22f_wma\x22:\x220\x22,\x22f_dir\x22:\x220\x22,\x22f_fla\x22:\x221\x22,\x22f_java\x22:\x220\x22,\x22f_gears\x22:\x220\x22,\x22f_ag\x22:\x220\x22,\x22res\x22:\x221366x768\x22,\x22cd\x22:\x2224\x22,\x22cookie\x22:\x221\x22,\x22eid\x22:\x2232ef32da-6fd5-4c59-8dde-45e65eac91ae\x22,\x22dtm\x22:\x221460742427188\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22data\x5C\x22:{\x5C\x22utm_source\x5C\x22:\x5C\x22utargetWoman\x5C\x22,\x5C\x22utm_medium\x5C\x22:\x5C\x22clickunder\x5C\x22,\x5C\x22utm_campaign\x5C\x22:\x5C\x221262\x5C\x22,\x5C\x22utm_content\x5C\x22:null,\x5C\x22utm_term\x5C\x22:null}}]}\x22,\x22vp\x22:\x221366x620\x22,\x22ds\x22:\x221349x4058\x22,\x22vid\x22:\x222\x22,\x22duid\x22:\x22d963f2da47d1dbfa\x22,\x22fp\x22:\x222883037804\x22}]},\x22http_referer\x22:\x22https://qlean.ru/?promocode=utarget&utm_source=utargetWoman&utm_medium=clickunder&utm_campaign=1262\x22,\x22http_user_agent\x22:\x22Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\x22}`,
		map[string]interface{}{
			"Id":               int(0),
			"Aid":              sql.NullString{`qlean_web_app`, true},
			"Platform":         sql.NullString{`web`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-04-15T17:47:07Z"); return t }(),
			"Event":            sql.NullString{`pv`, true},
			"EventID":          sql.NullString{`32ef32da-6fd5-4c59-8dde-45e65eac91ae`, true},
			"VTracker":         sql.NullString{`js-2.4.3`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`109.252.206.94`, true},
			"UserFingerprint":  sql.NullString{`2883037804`, true},
			"DomainUserID":     sql.NullString{`d963f2da47d1dbfa`, true},
			"VisitNum":         sql.NullInt64{int64(2), true},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`Russian Federation`, true},
			"PageURL":          sql.NullString{`https://qlean.ru/?promocode=utarget&utm_source=utargetWoman&utm_medium=clickunder&utm_campaign=1262`, true},
			"PageTtile":        sql.NullString{`Уборка квартир в Москве — недорогая уборка квартиры — Клининговая компания Qlean.ru`, true},
			"PageReferrer":     sql.NullString{`http://utarget.ru/goto/3175/fa0ac1ac16/`, true},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{`clickunder`, true},
			"UtmSource":        sql.NullString{`utargetWoman`, true},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{Valid: false},
			"UtmCampaign":      sql.NullString{`1262`, true},
			"Contexts":         sql.NullString{`{"utm_source":"utargetWoman","utm_medium":"clickunder","utm_campaign":"1262","utm_content":null,"utm_term":null}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{Valid: false},
			"Useragent":        sql.NullString{`Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36`, true},
			"BrName":           sql.NullString{`Chrome`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`49.0.2623.112`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`AppleWebKit537.36`, true},
			"BrLang":           sql.NullString{`ru`, true},
			"BrPDF":            bool(true),
			"BrFlash":          bool(true),
			"BrJava":           bool(false),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(false),
			"BrCookies":        bool(true),
			"BrColorDepth":     sql.NullInt64{int64(24), true},
			"BrViewWidth":      int(1366),
			"BrViewHeight":     int(620),
			"OsName":           sql.NullString{`Windows 7`, true},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{`Asia/Baghdad`, true},
			"DvceType":         sql.NullString{`Windows`, true},
			"DvceIsMobile":     bool(false),
			"DvceScreenWidth":  int(1366),
			"DvceScreenHeight": int(768),
			"DocCharset":       sql.NullString{`UTF-8`, true},
			"DocWidth":         int(1349),
			"DocHeight":        int(1349),
		},
	},
	{
		`Test 5`,
		`{\x22ip_addr\x22:\x2291.79.200.116\x22,\x22time_local\x22:\x2215/Apr/2016:13:47:15 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-2\x22,\x22data\x22:[{\x22e\x22:\x22pv\x22,\x22url\x22:\x22https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50&utm_content=21211259\x22,\x22page\x22:\x22\xD0\xA0\xD0\xB0\xD0\xB1\xD0\xBE\xD1\x82\xD0\xB0 \xD0\xB2 Qlean\x22,\x22refr\x22:\x22http://m.ok.ru\x22,\x22tv\x22:\x22js-2.4.3\x22,\x22tna\x22:\x22cf\x22,\x22aid\x22:\x22qlean_web_app\x22,\x22p\x22:\x22web\x22,\x22tz\x22:\x22Europe/Minsk\x22,\x22lang\x22:\x22ru-ru\x22,\x22cs\x22:\x22UTF-8\x22,\x22res\x22:\x22768x1024\x22,\x22cd\x22:\x2232\x22,\x22cookie\x22:\x221\x22,\x22eid\x22:\x220946f3db-a6b7-43a4-bac3-3435d768f0d4\x22,\x22dtm\x22:\x221460742486980\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22data\x5C\x22:{\x5C\x22utm_source\x5C\x22:\x5C\x22targetmail\x5C\x22,\x5C\x22utm_medium\x5C\x22:\x5C\x22dp\x5C\x22,\x5C\x22utm_campaign\x5C\x22:\x5C\x226335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50\x5C\x22,\x5C\x22utm_content\x5C\x22:\x5C\x2221211259\x5C\x22,\x5C\x22utm_term\x5C\x22:null}}]}\x22,\x22vp\x22:\x221024x704\x22,\x22ds\x22:\x221178x2340\x22,\x22vid\x22:\x221\x22,\x22duid\x22:\x2271fd48dee5043017\x22,\x22fp\x22:\x221805269845\x22}]},\x22http_referer\x22:\x22https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50&utm_content=21211259\x22,\x22http_user_agent\x22:\x22Mozilla/5.0 (iPad; CPU OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12F69 (iPad4,4) OKApp\x22}`,
		map[string]interface{}{
			"Id":               int(0),
			"Aid":              sql.NullString{`qlean_web_app`, true},
			"Platform":         sql.NullString{`web`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-04-15T17:48:06Z"); return t }(),
			"Event":            sql.NullString{`pv`, true},
			"EventID":          sql.NullString{`0946f3db-a6b7-43a4-bac3-3435d768f0d4`, true},
			"VTracker":         sql.NullString{`js-2.4.3`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`91.79.200.116`, true},
			"UserFingerprint":  sql.NullString{`1805269845`, true},
			"DomainUserID":     sql.NullString{`71fd48dee5043017`, true},
			"VisitNum":         sql.NullInt64{int64(1), true},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`Russian Federation`, true},
			"PageURL":          sql.NullString{`https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50&utm_content=21211259`, true},
			"PageTtile":        sql.NullString{`Работа в Qlean`, true},
			"PageReferrer":     sql.NullString{`http://m.ok.ru`, true},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{`dp`, true},
			"UtmSource":        sql.NullString{`targetmail`, true},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{`21211259`, true},
			"UtmCampaign":      sql.NullString{`6335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50`, true},
			"Contexts":         sql.NullString{`{"utm_source":"targetmail","utm_medium":"dp","utm_campaign":"6335537_Msk_Qlean_Jobs_Interests_Entertain_AND_F_25-50","utm_content":"21211259","utm_term":null}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{Valid: false},
			"Useragent":        sql.NullString{`Mozilla/5.0 (iPad; CPU OS 8_3 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12F69 (iPad4,4) OKApp`, true},
			"BrName":           sql.NullString{`Safari`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`12F69`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`AppleWebKit600.1.4`, true},
			"BrLang":           sql.NullString{`ru-ru`, true},
			"BrPDF":            bool(false),
			"BrFlash":          bool(false),
			"BrJava":           bool(false),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(false),
			"BrCookies":        bool(true),
			"BrColorDepth":     sql.NullInt64{int64(32), true},
			"BrViewWidth":      int(1024),
			"BrViewHeight":     int(704),
			"OsName":           sql.NullString{`CPU OS 8_3 like Mac OS X`, true},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{`Europe/Minsk`, true},
			"DvceType":         sql.NullString{`iPad`, true},
			"DvceIsMobile":     bool(true),
			"DvceScreenWidth":  int(768),
			"DvceScreenHeight": int(1024),
			"DocCharset":       sql.NullString{`UTF-8`, true},
			"DocWidth":         int(1178),
			"DocHeight":        int(1178),
		},
	},
	{
		`Test 6`,
		`{\x22ip_addr\x22:\x2277.232.15.82\x22,\x22time_local\x22:\x2215/Apr/2016:13:47:16 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-2\x22,\x22data\x22:[{\x22e\x22:\x22pv\x22,\x22url\x22:\x22https://qlean.ru/?promocode=utarget&utm_source=utargetNEWS&utm_medium=clickunder&utm_campaign=1248\x22,\x22page\x22:\x22\xD0\xA3\xD0\xB1\xD0\xBE\xD1\x80\xD0\xBA\xD0\xB0 \xD0\xBA\xD0\xB2\xD0\xB0\xD1\x80\xD1\x82\xD0\xB8\xD1\x80 \xD0\xB2 \xD0\x9C\xD0\xBE\xD1\x81\xD0\xBA\xD0\xB2\xD0\xB5 \xE2\x80\x94 \xD0\xBD\xD0\xB5\xD0\xB4\xD0\xBE\xD1\x80\xD0\xBE\xD0\xB3\xD0\xB0\xD1\x8F \xD1\x83\xD0\xB1\xD0\xBE\xD1\x80\xD0\xBA\xD0\xB0 \xD0\xBA\xD0\xB2\xD0\xB0\xD1\x80\xD1\x82\xD0\xB8\xD1\x80\xD1\x8B \xE2\x80\x94 \xD0\x9A\xD0\xBB\xD0\xB8\xD0\xBD\xD0\xB8\xD0\xBD\xD0\xB3\xD0\xBE\xD0\xB2\xD0\xB0\xD1\x8F \xD0\xBA\xD0\xBE\xD0\xBC\xD0\xBF\xD0\xB0\xD0\xBD\xD0\xB8\xD1\x8F Qlean.ru\x22,\x22refr\x22:\x22http://utarget.ru/goto/2807/dbda1ddd32/\x22,\x22tv\x22:\x22js-2.4.3\x22,\x22tna\x22:\x22cf\x22,\x22aid\x22:\x22qlean_web_app\x22,\x22p\x22:\x22web\x22,\x22tz\x22:\x22Europe/Minsk\x22,\x22lang\x22:\x22ru-RU\x22,\x22cs\x22:\x22utf-8\x22,\x22f_pdf\x22:\x220\x22,\x22f_qt\x22:\x220\x22,\x22f_realp\x22:\x220\x22,\x22f_wma\x22:\x220\x22,\x22f_dir\x22:\x220\x22,\x22f_fla\x22:\x221\x22,\x22f_java\x22:\x221\x22,\x22f_gears\x22:\x220\x22,\x22f_ag\x22:\x221\x22,\x22res\x22:\x221536x864\x22,\x22cd\x22:\x2224\x22,\x22cookie\x22:\x221\x22,\x22eid\x22:\x223707d483-3af3-4b7d-a54a-b9f8c0dd0809\x22,\x22dtm\x22:\x221460742438734\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22data\x5C\x22:{\x5C\x22utm_source\x5C\x22:\x5C\x22utargetNEWS\x5C\x22,\x5C\x22utm_medium\x5C\x22:\x5C\x22clickunder\x5C\x22,\x5C\x22utm_campaign\x5C\x22:\x5C\x221248\x5C\x22,\x5C\x22utm_content\x5C\x22:null,\x5C\x22utm_term\x5C\x22:null}}]}\x22,\x22vp\x22:\x221523x747\x22,\x22ds\x22:\x221523x4107\x22,\x22vid\x22:\x221\x22,\x22duid\x22:\x227656f6f7b9f4bb80\x22,\x22fp\x22:\x22764876351\x22}]},\x22http_referer\x22:\x22https://qlean.ru/?promocode=utarget&utm_source=utargetNEWS&utm_medium=clickunder&utm_campaign=1248\x22,\x22http_user_agent\x22:\x22Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko\x22}`,
		map[string]interface{}{
			"Id":               int(0),
			"Aid":              sql.NullString{`qlean_web_app`, true},
			"Platform":         sql.NullString{`web`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-04-15T17:47:18Z"); return t }(),
			"Event":            sql.NullString{`pv`, true},
			"EventID":          sql.NullString{`3707d483-3af3-4b7d-a54a-b9f8c0dd0809`, true},
			"VTracker":         sql.NullString{`js-2.4.3`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`77.232.15.82`, true},
			"UserFingerprint":  sql.NullString{`764876351`, true},
			"DomainUserID":     sql.NullString{`7656f6f7b9f4bb80`, true},
			"VisitNum":         sql.NullInt64{int64(1), true},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`Russian Federation`, true},
			"PageURL":          sql.NullString{`https://qlean.ru/?promocode=utarget&utm_source=utargetNEWS&utm_medium=clickunder&utm_campaign=1248`, true},
			"PageTtile":        sql.NullString{`Уборка квартир в Москве — недорогая уборка квартиры — Клининговая компания Qlean.ru`, true},
			"PageReferrer":     sql.NullString{`http://utarget.ru/goto/2807/dbda1ddd32/`, true},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{`clickunder`, true},
			"UtmSource":        sql.NullString{`utargetNEWS`, true},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{Valid: false},
			"UtmCampaign":      sql.NullString{`1248`, true},
			"Contexts":         sql.NullString{`{"utm_source":"utargetNEWS","utm_medium":"clickunder","utm_campaign":"1248","utm_content":null,"utm_term":null}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{Valid: false},
			"Useragent":        sql.NullString{`Mozilla/5.0 (Windows NT 6.1; WOW64; Trident/7.0; rv:11.0) like Gecko`, true},
			"BrName":           sql.NullString{`Internet Explorer`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`11.0`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`Trident`, true},
			"BrLang":           sql.NullString{`ru-RU`, true},
			"BrPDF":            bool(false),
			"BrFlash":          bool(true),
			"BrJava":           bool(true),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(true),
			"BrCookies":        bool(true),
			"BrColorDepth":     sql.NullInt64{int64(24), true},
			"BrViewWidth":      int(1523),
			"BrViewHeight":     int(747),
			"OsName":           sql.NullString{`Windows 7`, true},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{`Europe/Minsk`, true},
			"DvceType":         sql.NullString{`Windows`, true},
			"DvceIsMobile":     bool(false),
			"DvceScreenWidth":  int(1536),
			"DvceScreenHeight": int(864),
			"DocCharset":       sql.NullString{`utf-8`, true},
			"DocWidth":         int(1523),
			"DocHeight":        int(1523),
		},
	},
	{
		`Test 7`,
		`{\x22ip_addr\x22:\x22213.141.144.121\x22,\x22time_local\x22:\x2215/Apr/2016:13:47:16 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow\x5C/payload_data\x5C/jsonschema\x5C/1-0-3\x22,\x22data\x22:[{\x22ue_pr\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow\x5C\x5C\x5C/unstruct_event\x5C\x5C\x5C/jsonschema\x5C\x5C\x5C/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow\x5C\x5C\x5C/screen_view\x5C\x5C\x5C/jsonschema\x5C\x5C\x5C/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:{\x5C\x22id\x5C\x22:\x5C\x22OrderCardViewController\x5C\x22,\x5C\x22name\x5C\x22:\x5C\x22OrderCardViewController\x5C\x22}}}\x22,\x22aid\x22:\x22ios_02\x22,\x22res\x22:\x22750x1334\x22,\x22p\x22:\x22mob\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow\x5C\x5C\x5C/contexts\x5C\x5C\x5C/jsonschema\x5C\x5C\x5C/1-0-1\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22app_version\x5C\x22:\x5C\x221.4.8\x5C\x22,\x5C\x22test_id\x5C\x22:\x5C\x22ContactEmailFormPosition\x5C\x22,\x5C\x22orderId\x5C\x22:\x5C\x22-1\x5C\x22,\x5C\x22screenName\x5C\x22:\x5C\x22OrderCardViewController\x5C\x22,\x5C\x22platformDict\x5C\x22:{\x5C\x22osType\x5C\x22:\x5C\x22ios\x5C\x22,\x5C\x22deviceModel\x5C\x22:\x5C\x22iPhone\x5C\x22,\x5C\x22openIdfa\x5C\x22:\x5C\x22BFB2ED33-5963-9849-0D3E-AC56404FD5CC\x5C\x22,\x5C\x22osVersion\x5C\x22:\x5C\x229.3.1\x5C\x22,\x5C\x22networkTechnology\x5C\x22:\x5C\x22CTRadioAccessTechnologyHSDPA\x5C\x22,\x5C\x22appleIdfv\x5C\x22:\x5C\x22645C9A70-5E80-4314-A82E-D2088A6D34B8\x5C\x22,\x5C\x22carrier\x5C\x22:\x5C\x22Beeline\x5C\x22,\x5C\x22deviceManufacturer\x5C\x22:\x5C\x22Apple Inc.\x5C\x22,\x5C\x22networkType\x5C\x22:\x5C\x22wifi\x5C\x22,\x5C\x22appleIdfa\x5C\x22:\x5C\x2214D53303-9515-4A1E-9FC6-65EAAFEF113E\x5C\x22},\x5C\x22test_var\x5C\x22:\x5C\x22ShowFormOnRegister\x5C\x22,\x5C\x22userId\x5C\x22:\x5C\x2259121\x5C\x22},{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow\x5C\x5C\x5C/mobile_context\x5C\x5C\x5C/jsonschema\x5C\x5C\x5C/1-0-1\x5C\x22,\x5C\x22data\x5C\x22:{\x5C\x22osType\x5C\x22:\x5C\x22ios\x5C\x22,\x5C\x22networkType\x5C\x22:\x5C\x22wifi\x5C\x22,\x5C\x22openIdfa\x5C\x22:\x5C\x22BFB2ED33-5963-9849-0D3E-AC56404FD5CC\x5C\x22,\x5C\x22osVersion\x5C\x22:\x5C\x229.3.1\x5C\x22,\x5C\x22networkTechnology\x5C\x22:\x5C\x22CTRadioAccessTechnologyHSDPA\x5C\x22,\x5C\x22appleIdfv\x5C\x22:\x5C\x22645C9A70-5E80-4314-A82E-D2088A6D34B8\x5C\x22,\x5C\x22carrier\x5C\x22:\x5C\x22Beeline\x5C\x22,\x5C\x22deviceManufacturer\x5C\x22:\x5C\x22Apple Inc.\x5C\x22,\x5C\x22appleIdfa\x5C\x22:\x5C\x2214D53303-9515-4A1E-9FC6-65EAAFEF113E\x5C\x22,\x5C\x22deviceModel\x5C\x22:\x5C\x22iPhone\x5C\x22}}]}\x22,\x22stm\x22:\x221460742435916\x22,\x22dtm\x22:\x221460742436\x22,\x22tv\x22:\x22ios-0.5.2\x22,\x22tna\x22:\x22sdk\x22,\x22e\x22:\x22ue\x22,\x22lang\x22:\x22ru\x22,\x22vp\x22:\x22750x1334\x22,\x22eid\x22:\x222d2084d1-c778-4839-bffd-f66b4c3c3257\x22}]},\x22http_referer\x22:\x22-\x22,\x22http_user_agent\x22:\x22Qlean/59 CFNetwork/758.3.15 Darwin/15.4.0\x22}`,
		map[string]interface{}{
			"Id":               int(0),
			"Aid":              sql.NullString{`ios_02`, true},
			"Platform":         sql.NullString{`mob`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-04-15T17:47:16Z"); return t }(),
			"Event":            sql.NullString{`ue`, true},
			"EventID":          sql.NullString{`2d2084d1-c778-4839-bffd-f66b4c3c3257`, true},
			"VTracker":         sql.NullString{`ios-0.5.2`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`213.141.144.121`, true},
			"UserFingerprint":  sql.NullString{Valid: false},
			"DomainUserID":     sql.NullString{Valid: false},
			"VisitNum":         sql.NullInt64{Valid: false},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`Russian Federation`, true},
			"PageURL":          sql.NullString{Valid: false},
			"PageTtile":        sql.NullString{Valid: false},
			"PageReferrer":     sql.NullString{Valid: false},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{Valid: false},
			"UtmSource":        sql.NullString{Valid: false},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{Valid: false},
			"UtmCampaign":      sql.NullString{Valid: false},
			"Contexts":         sql.NullString{`{"app_version":"1.4.8","test_id":"ContactEmailFormPosition","orderId":"-1","screenName":"OrderCardViewController","platformDict":{"osType":"ios","deviceModel":"iPhone","openIdfa":"BFB2ED33-5963-9849-0D3E-AC56404FD5CC","osVersion":"9.3.1","networkTechnology":"CTRadioAccessTechnologyHSDPA","appleIdfv":"645C9A70-5E80-4314-A82E-D2088A6D34B8","carrier":"Beeline","deviceManufacturer":"Apple Inc.","networkType":"wifi","appleIdfa":"14D53303-9515-4A1E-9FC6-65EAAFEF113E"},"test_var":"ShowFormOnRegister","userId":"59121"}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{`{"schema":"iglu:com.snowplowanalytics.snowplow\/unstruct_event\/jsonschema\/1-0-0","data":{"schema":"iglu:com.snowplowanalytics.snowplow\/screen_view\/jsonschema\/1-0-0","data":{"id":"OrderCardViewController","name":"OrderCardViewController"}}}`, true},
			"Useragent":        sql.NullString{`Qlean/59 CFNetwork/758.3.15 Darwin/15.4.0`, true},
			"BrName":           sql.NullString{`Qlean`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`59`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`CFNetwork758.3.15`, true},
			"BrLang":           sql.NullString{`ru`, true},
			"BrPDF":            bool(false),
			"BrFlash":          bool(false),
			"BrJava":           bool(false),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(false),
			"BrCookies":        bool(false),
			"BrColorDepth":     sql.NullInt64{Valid: false},
			"BrViewWidth":      int(750),
			"BrViewHeight":     int(1334),
			"OsName":           sql.NullString{Valid: false},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{Valid: false},
			"DvceType":         sql.NullString{Valid: false},
			"DvceIsMobile":     bool(false),
			"DvceScreenWidth":  int(750),
			"DvceScreenHeight": int(1334),
			"DocCharset":       sql.NullString{Valid: false},
			"DocWidth":         int(0),
			"DocHeight":        int(0),
		},
	},
	{
		`Test 8`,
		`{\x22ip_addr\x22:\x2237.153.16.3\x22,\x22time_local\x22:\x2215/Apr/2016:13:47:18 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow\x5C/payload_data\x5C/jsonschema\x5C/1-0-3\x22,\x22data\x22:[{\x22ue_pr\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow\x5C\x5C\x5C/unstruct_event\x5C\x5C\x5C/jsonschema\x5C\x5C\x5C/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow\x5C\x5C\x5C/screen_view\x5C\x5C\x5C/jsonschema\x5C\x5C\x5C/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:{\x5C\x22id\x5C\x22:\x5C\x22OptionViewController\x5C\x22,\x5C\x22name\x5C\x22:\x5C\x22OptionViewController\x5C\x22}}}\x22,\x22aid\x22:\x22ios_02\x22,\x22res\x22:\x22750x1334\x22,\x22p\x22:\x22mob\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow\x5C\x5C\x5C/contexts\x5C\x5C\x5C/jsonschema\x5C\x5C\x5C/1-0-1\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22app_version\x5C\x22:\x5C\x221.4.8\x5C\x22,\x5C\x22test_id\x5C\x22:\x5C\x22ContactEmailFormPosition\x5C\x22,\x5C\x22orderId\x5C\x22:\x5C\x22260798\x5C\x22,\x5C\x22screenName\x5C\x22:\x5C\x22OptionViewController\x5C\x22,\x5C\x22platformDict\x5C\x22:{\x5C\x22osType\x5C\x22:\x5C\x22ios\x5C\x22,\x5C\x22deviceModel\x5C\x22:\x5C\x22iPhone\x5C\x22,\x5C\x22openIdfa\x5C\x22:\x5C\x22283CCE48-14DD-C307-B29A-A7131BA640B5\x5C\x22,\x5C\x22osVersion\x5C\x22:\x5C\x229.3.1\x5C\x22,\x5C\x22networkTechnology\x5C\x22:\x5C\x22CTRadioAccessTechnologyLTE\x5C\x22,\x5C\x22appleIdfv\x5C\x22:\x5C\x22FCFFAA70-D4C6-45E1-98AB-D764DE29CB28\x5C\x22,\x5C\x22carrier\x5C\x22:\x5C\x22Beeline\x5C\x22,\x5C\x22deviceManufacturer\x5C\x22:\x5C\x22Apple Inc.\x5C\x22,\x5C\x22networkType\x5C\x22:\x5C\x22wifi\x5C\x22,\x5C\x22appleIdfa\x5C\x22:\x5C\x2213B32DF4-F9F0-4556-BFBE-F5B2B7B69B55\x5C\x22},\x5C\x22test_var\x5C\x22:\x5C\x22ShowFormOnOrderCreate\x5C\x22,\x5C\x22userId\x5C\x22:\x5C\x2231063\x5C\x22},{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow\x5C\x5C\x5C/mobile_context\x5C\x5C\x5C/jsonschema\x5C\x5C\x5C/1-0-1\x5C\x22,\x5C\x22data\x5C\x22:{\x5C\x22osType\x5C\x22:\x5C\x22ios\x5C\x22,\x5C\x22networkType\x5C\x22:\x5C\x22wifi\x5C\x22,\x5C\x22openIdfa\x5C\x22:\x5C\x22283CCE48-14DD-C307-B29A-A7131BA640B5\x5C\x22,\x5C\x22osVersion\x5C\x22:\x5C\x229.3.1\x5C\x22,\x5C\x22networkTechnology\x5C\x22:\x5C\x22CTRadioAccessTechnologyLTE\x5C\x22,\x5C\x22appleIdfv\x5C\x22:\x5C\x22FCFFAA70-D4C6-45E1-98AB-D764DE29CB28\x5C\x22,\x5C\x22carrier\x5C\x22:\x5C\x22Beeline\x5C\x22,\x5C\x22deviceManufacturer\x5C\x22:\x5C\x22Apple Inc.\x5C\x22,\x5C\x22appleIdfa\x5C\x22:\x5C\x2213B32DF4-F9F0-4556-BFBE-F5B2B7B69B55\x5C\x22,\x5C\x22deviceModel\x5C\x22:\x5C\x22iPhone\x5C\x22}}]}\x22,\x22stm\x22:\x221460742438226\x22,\x22dtm\x22:\x221460742438\x22,\x22tv\x22:\x22ios-0.5.2\x22,\x22tna\x22:\x22sdk\x22,\x22e\x22:\x22ue\x22,\x22lang\x22:\x22ru\x22,\x22vp\x22:\x22750x1334\x22,\x22eid\x22:\x2284ee7098-82a6-4b56-815d-d5ca49325abf\x22}]},\x22http_referer\x22:\x22-\x22,\x22http_user_agent\x22:\x22Qlean/59 CFNetwork/758.3.15 Darwin/15.4.0\x22}`,
		map[string]interface{}{
			"Id":               int(0),
			"Aid":              sql.NullString{`ios_02`, true},
			"Platform":         sql.NullString{`mob`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-04-15T17:47:18Z"); return t }(),
			"Event":            sql.NullString{`ue`, true},
			"EventID":          sql.NullString{`84ee7098-82a6-4b56-815d-d5ca49325abf`, true},
			"VTracker":         sql.NullString{`ios-0.5.2`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`37.153.16.3`, true},
			"UserFingerprint":  sql.NullString{Valid: false},
			"DomainUserID":     sql.NullString{Valid: false},
			"VisitNum":         sql.NullInt64{Valid: false},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`Russian Federation`, true},
			"PageURL":          sql.NullString{Valid: false},
			"PageTtile":        sql.NullString{Valid: false},
			"PageReferrer":     sql.NullString{Valid: false},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{Valid: false},
			"UtmSource":        sql.NullString{Valid: false},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{Valid: false},
			"UtmCampaign":      sql.NullString{Valid: false},
			"Contexts":         sql.NullString{`{"app_version":"1.4.8","test_id":"ContactEmailFormPosition","orderId":"260798","screenName":"OptionViewController","platformDict":{"osType":"ios","deviceModel":"iPhone","openIdfa":"283CCE48-14DD-C307-B29A-A7131BA640B5","osVersion":"9.3.1","networkTechnology":"CTRadioAccessTechnologyLTE","appleIdfv":"FCFFAA70-D4C6-45E1-98AB-D764DE29CB28","carrier":"Beeline","deviceManufacturer":"Apple Inc.","networkType":"wifi","appleIdfa":"13B32DF4-F9F0-4556-BFBE-F5B2B7B69B55"},"test_var":"ShowFormOnOrderCreate","userId":"31063"}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{`{"schema":"iglu:com.snowplowanalytics.snowplow\/unstruct_event\/jsonschema\/1-0-0","data":{"schema":"iglu:com.snowplowanalytics.snowplow\/screen_view\/jsonschema\/1-0-0","data":{"id":"OptionViewController","name":"OptionViewController"}}}`, true},
			"Useragent":        sql.NullString{`Qlean/59 CFNetwork/758.3.15 Darwin/15.4.0`, true},
			"BrName":           sql.NullString{`Qlean`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`59`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`CFNetwork758.3.15`, true},
			"BrLang":           sql.NullString{`ru`, true},
			"BrPDF":            bool(false),
			"BrFlash":          bool(false),
			"BrJava":           bool(false),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(false),
			"BrCookies":        bool(false),
			"BrColorDepth":     sql.NullInt64{Valid: false},
			"BrViewWidth":      int(750),
			"BrViewHeight":     int(1334),
			"OsName":           sql.NullString{Valid: false},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{Valid: false},
			"DvceType":         sql.NullString{Valid: false},
			"DvceIsMobile":     bool(false),
			"DvceScreenWidth":  int(750),
			"DvceScreenHeight": int(1334),
			"DocCharset":       sql.NullString{Valid: false},
			"DocWidth":         int(0),
			"DocHeight":        int(0),
		},
	},
	{
		`Test 9`,
		`{\x22ip_addr\x22:\x2289.222.242.1\x22,\x22time_local\x22:\x2215/Apr/2016:13:47:19 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-2\x22,\x22data\x22:[{\x22e\x22:\x22pv\x22,\x22url\x22:\x22https://qlean.ru/jobs/msk\x22,\x22page\x22:\x22\xD0\xA0\xD0\xB0\xD0\xB1\xD0\xBE\xD1\x82\xD0\xB0 \xD0\xB2 Qlean\x22,\x22refr\x22:\x22http://ok.ru/\x22,\x22tv\x22:\x22js-2.4.3\x22,\x22tna\x22:\x22cf\x22,\x22aid\x22:\x22qlean_web_app\x22,\x22p\x22:\x22web\x22,\x22tz\x22:\x22Asia/Baghdad\x22,\x22lang\x22:\x22ru\x22,\x22cs\x22:\x22UTF-8\x22,\x22f_pdf\x22:\x221\x22,\x22f_qt\x22:\x220\x22,\x22f_realp\x22:\x220\x22,\x22f_wma\x22:\x220\x22,\x22f_dir\x22:\x220\x22,\x22f_fla\x22:\x221\x22,\x22f_java\x22:\x221\x22,\x22f_gears\x22:\x220\x22,\x22f_ag\x22:\x221\x22,\x22res\x22:\x221440x900\x22,\x22cd\x22:\x2224\x22,\x22cookie\x22:\x221\x22,\x22eid\x22:\x225d3ab1cc-546b-4e9b-8319-64dcf6cb48a8\x22,\x22dtm\x22:\x221460742473745\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22data\x5C\x22:{\x5C\x22utm_source\x5C\x22:\x5C\x22mytarget\x5C\x22,\x5C\x22utm_medium\x5C\x22:\x5C\x22cpc\x5C\x22,\x5C\x22utm_campaign\x5C\x22:\x5C\x226198246\x5C\x22,\x5C\x22utm_content\x5C\x22:\x5C\x2220668308\x5C\x22,\x5C\x22utm_term\x5C\x22:null}}]}\x22,\x22vp\x22:\x221136x583\x22,\x22ds\x22:\x221287x2339\x22,\x22vid\x22:\x221\x22,\x22duid\x22:\x22ddccdb532dd42279\x22,\x22fp\x22:\x223529556421\x22}]},\x22http_referer\x22:\x22https://qlean.ru/jobs/msk\x22,\x22http_user_agent\x22:\x22Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.110 Safari/537.36 OPR/36.0.2130.65 (Edition Yx)\x22}`,
		map[string]interface{}{
			"Id":               int(0),
			"Aid":              sql.NullString{`qlean_web_app`, true},
			"Platform":         sql.NullString{`web`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-04-15T17:47:53Z"); return t }(),
			"Event":            sql.NullString{`pv`, true},
			"EventID":          sql.NullString{`5d3ab1cc-546b-4e9b-8319-64dcf6cb48a8`, true},
			"VTracker":         sql.NullString{`js-2.4.3`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`89.222.242.1`, true},
			"UserFingerprint":  sql.NullString{`3529556421`, true},
			"DomainUserID":     sql.NullString{`ddccdb532dd42279`, true},
			"VisitNum":         sql.NullInt64{int64(1), true},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`Russian Federation`, true},
			"PageURL":          sql.NullString{`https://qlean.ru/jobs/msk`, true},
			"PageTtile":        sql.NullString{`Работа в Qlean`, true},
			"PageReferrer":     sql.NullString{`http://ok.ru/`, true},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{`cpc`, true},
			"UtmSource":        sql.NullString{`mytarget`, true},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{`20668308`, true},
			"UtmCampaign":      sql.NullString{`6198246`, true},
			"Contexts":         sql.NullString{`{"utm_source":"mytarget","utm_medium":"cpc","utm_campaign":"6198246","utm_content":"20668308","utm_term":null}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{Valid: false},
			"Useragent":        sql.NullString{`Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.110 Safari/537.36 OPR/36.0.2130.65 (Edition Yx)`, true},
			"BrName":           sql.NullString{`Opera`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`36.0.2130.65`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`AppleWebKit537.36`, true},
			"BrLang":           sql.NullString{`ru`, true},
			"BrPDF":            bool(true),
			"BrFlash":          bool(true),
			"BrJava":           bool(true),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(true),
			"BrCookies":        bool(true),
			"BrColorDepth":     sql.NullInt64{int64(24), true},
			"BrViewWidth":      int(1136),
			"BrViewHeight":     int(583),
			"OsName":           sql.NullString{`Windows 7`, true},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{`Asia/Baghdad`, true},
			"DvceType":         sql.NullString{`Windows`, true},
			"DvceIsMobile":     bool(false),
			"DvceScreenWidth":  int(1440),
			"DvceScreenHeight": int(900),
			"DocCharset":       sql.NullString{`UTF-8`, true},
			"DocWidth":         int(1287),
			"DocHeight":        int(1287),
		},
	},
	{
		`Test 10`,
		`{\x22ip_addr\x22:\x22109.252.171.196\x22,\x22time_local\x22:\x2215/Apr/2016:13:47:22 -0400\x22,\x22request_body\x22:{\x22schema\x22:\x22iglu:com.snowplowanalytics.snowplow/payload_data/jsonschema/1-0-2\x22,\x22data\x22:[{\x22e\x22:\x22pv\x22,\x22url\x22:\x22https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335575_Msk_Qlean_Jobs_Interests_WorkHome_WEB_F_25-50&utm_content=21211364\x22,\x22page\x22:\x22\xD0\xA0\xD0\xB0\xD0\xB1\xD0\xBE\xD1\x82\xD0\xB0 \xD0\xB2 Qlean\x22,\x22tv\x22:\x22js-2.4.3\x22,\x22tna\x22:\x22cf\x22,\x22aid\x22:\x22qlean_web_app\x22,\x22p\x22:\x22web\x22,\x22tz\x22:\x22Europe/Helsinki\x22,\x22lang\x22:\x22ru\x22,\x22cs\x22:\x22UTF-8\x22,\x22f_pdf\x22:\x221\x22,\x22f_qt\x22:\x220\x22,\x22f_realp\x22:\x220\x22,\x22f_wma\x22:\x220\x22,\x22f_dir\x22:\x220\x22,\x22f_fla\x22:\x221\x22,\x22f_java\x22:\x220\x22,\x22f_gears\x22:\x220\x22,\x22f_ag\x22:\x220\x22,\x22res\x22:\x221366x768\x22,\x22cd\x22:\x2224\x22,\x22cookie\x22:\x221\x22,\x22eid\x22:\x22995a6562-ed1a-4ccd-8ca9-27061a908d5a\x22,\x22dtm\x22:\x221460742438962\x22,\x22co\x22:\x22{\x5C\x22schema\x5C\x22:\x5C\x22iglu:com.snowplowanalytics.snowplow/contexts/jsonschema/1-0-0\x5C\x22,\x5C\x22data\x5C\x22:[{\x5C\x22data\x5C\x22:{\x5C\x22utm_source\x5C\x22:\x5C\x22targetmail\x5C\x22,\x5C\x22utm_medium\x5C\x22:\x5C\x22dp\x5C\x22,\x5C\x22utm_campaign\x5C\x22:\x5C\x226335575_Msk_Qlean_Jobs_Interests_WorkHome_WEB_F_25-50\x5C\x22,\x5C\x22utm_content\x5C\x22:\x5C\x2221211364\x5C\x22,\x5C\x22utm_term\x5C\x22:null}}]}\x22,\x22vp\x22:\x221366x667\x22,\x22ds\x22:\x221527x2340\x22,\x22vid\x22:\x223\x22,\x22duid\x22:\x229db46bb5fa420ef4\x22,\x22fp\x22:\x223929055814\x22}]},\x22http_referer\x22:\x22https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335575_Msk_Qlean_Jobs_Interests_WorkHome_WEB_F_25-50&utm_content=21211364\x22,\x22http_user_agent\x22:\x22Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\x22}`,
		map[string]interface{}{
			"Id":               int(0),
			"Aid":              sql.NullString{`qlean_web_app`, true},
			"Platform":         sql.NullString{`web`, true},
			"DvceTstamp":       func() time.Time { t, _ := time.Parse(time.RFC3339, "2016-04-15T17:47:18Z"); return t }(),
			"Event":            sql.NullString{`pv`, true},
			"EventID":          sql.NullString{`995a6562-ed1a-4ccd-8ca9-27061a908d5a`, true},
			"VTracker":         sql.NullString{`js-2.4.3`, true},
			"UserID":           sql.NullInt64{Valid: false},
			"UserIP":           sql.NullString{`109.252.171.196`, true},
			"UserFingerprint":  sql.NullString{`3929055814`, true},
			"DomainUserID":     sql.NullString{`9db46bb5fa420ef4`, true},
			"VisitNum":         sql.NullInt64{int64(3), true},
			"SessionID":        sql.NullString{Valid: false},
			"GeoCountry":       sql.NullString{`Russian Federation`, true},
			"PageURL":          sql.NullString{`https://qlean.ru/jobs/msk?utm_source=targetmail&utm_medium=dp&utm_campaign=6335575_Msk_Qlean_Jobs_Interests_WorkHome_WEB_F_25-50&utm_content=21211364`, true},
			"PageTtile":        sql.NullString{`Работа в Qlean`, true},
			"PageReferrer":     sql.NullString{Valid: false},
			"PageURLHost":      sql.NullString{Valid: false},
			"PageURLPath":      sql.NullString{Valid: false},
			"PageURLQuery":     sql.NullString{Valid: false},
			"RefrURLHost":      sql.NullString{Valid: false},
			"RefrURLPath":      sql.NullString{Valid: false},
			"RefrURLQuety":     sql.NullString{Valid: false},
			"UtmMedium":        sql.NullString{`dp`, true},
			"UtmSource":        sql.NullString{`targetmail`, true},
			"UtmTerm":          sql.NullString{Valid: false},
			"UtmContent":       sql.NullString{`21211364`, true},
			"UtmCampaign":      sql.NullString{`6335575_Msk_Qlean_Jobs_Interests_WorkHome_WEB_F_25-50`, true},
			"Contexts":         sql.NullString{`{"utm_source":"targetmail","utm_medium":"dp","utm_campaign":"6335575_Msk_Qlean_Jobs_Interests_WorkHome_WEB_F_25-50","utm_content":"21211364","utm_term":null}`, true},
			"SeCategory":       sql.NullString{Valid: false},
			"SeAction":         sql.NullString{Valid: false},
			"SeLabel":          sql.NullString{Valid: false},
			"SeProperty":       sql.NullString{Valid: false},
			"SeValue":          sql.NullFloat64{Valid: false},
			"UnstructEvent":    sql.NullString{Valid: false},
			"Useragent":        sql.NullString{`Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36`, true},
			"BrName":           sql.NullString{`Chrome`, true},
			"BrFamily":         sql.NullString{Valid: false},
			"BrVersion":        sql.NullString{`49.0.2623.112`, true},
			"BrType":           sql.NullString{Valid: false},
			"BrRndrNgn":        sql.NullString{`AppleWebKit537.36`, true},
			"BrLang":           sql.NullString{`ru`, true},
			"BrPDF":            bool(true),
			"BrFlash":          bool(true),
			"BrJava":           bool(false),
			"BrDir":            bool(false),
			"BrQT":             bool(false),
			"BrRealPlayer":     bool(false),
			"BrWMA":            bool(false),
			"BrGears":          bool(false),
			"BrAg":             bool(false),
			"BrCookies":        bool(true),
			"BrColorDepth":     sql.NullInt64{int64(24), true},
			"BrViewWidth":      int(1366),
			"BrViewHeight":     int(667),
			"OsName":           sql.NullString{`Windows 7`, true},
			"OsFamily":         sql.NullString{Valid: false},
			"OsManufacturer":   sql.NullString{Valid: false},
			"OsTimezone":       sql.NullString{`Europe/Helsinki`, true},
			"DvceType":         sql.NullString{`Windows`, true},
			"DvceIsMobile":     bool(false),
			"DvceScreenWidth":  int(1366),
			"DvceScreenHeight": int(768),
			"DocCharset":       sql.NullString{`UTF-8`, true},
			"DocWidth":         int(1527),
			"DocHeight":        int(1527),
		},
	},
}

func (event *SnowplowEvent) PrintStatement() {
	nullStringType := reflect.TypeOf(sql.NullString{})
	nullInt64Type := reflect.TypeOf(sql.NullInt64{})
	NullTimeType := reflect.TypeOf(NullTime{})
	nullFloat64Type := reflect.TypeOf(sql.NullFloat64{})
	structType := reflect.TypeOf(*event)
	eventValues := reflect.ValueOf(event).Elem()

	for i := 0; i < structType.NumField(); i++ {
		field := structType.Field(i)
		fieldValue := eventValues.FieldByName(field.Name)
		switch field.Type {
		case nullStringType:
			fmt.Printf(`"%s": `, field.Name)
			if fieldValue.FieldByName("Valid").Bool() {
				fmt.Printf(`sql.NullString{`)
				fmt.Printf("`%s`", fieldValue.FieldByName("String").String())
				fmt.Printf(`, true}`)
			} else {
				fmt.Printf(`sql.NullString{Valid: false}`)
			}
			fmt.Printf(",\n")
		case nullInt64Type:
			fmt.Printf(`"%s": `, field.Name)
			if fieldValue.FieldByName("Valid").Bool() {
				fmt.Printf(`sql.NullInt64{int64(%d), true}`, fieldValue.FieldByName("Int64").Int())
			} else {
				fmt.Printf(`sql.NullInt64{Valid: false}`)
			}
			fmt.Printf(",\n")
		case nullFloat64Type:
			fmt.Printf(`"%s": `, field.Name)
			if fieldValue.FieldByName("Valid").Bool() {
				fmt.Printf(`sql.NullFloat64{float64(%f), true}`, fieldValue.FieldByName("Float64").Float())
			} else {
				fmt.Printf(`sql.NullFloat64{Valid: false}`)
			}
			fmt.Printf(",\n")
		case NullTimeType:
			fmt.Printf(`"%s": `, field.Name)
			if fieldValue.FieldByName("Valid").Bool() {
				fmt.Printf(`NullTime{ func () time.Time { t, _ := time.Parse(time.RFC3339, "%s"); return t;}() , true}`, fieldValue.FieldByName("Time").Interface().(time.Time).Format(time.RFC3339))
			} else {
				fmt.Printf(`NullTime{Valid: false}`)
			}
			fmt.Printf(",\n")
		case reflect.TypeOf(time.Time{}):
			fmt.Printf(`"%s": `, field.Name)
			fmt.Printf(`func () time.Time { t, _ := time.Parse(time.RFC3339, "%s"); return t;}()`, fieldValue.Interface().(time.Time).Format(time.RFC3339))
			fmt.Printf(",\n")
			// case reflect.TypeOf(false):
			// 	fmt.Printf(`"%s": `, field.Name)
			// 	fmt.Printf("bool(%t)", fieldValue.Interface())
			// 	fmt.Printf(",\n")
			// case reflect.TypeOf(float32(0)):
			// 	fmt.Printf(`"%s": `, field.Name)
			// 	fmt.Printf("float32(%f)", fieldValue.Interface())
			// 	fmt.Printf(",\n")
			// case reflect.TypeOf(int(0)):
			// 	fmt.Printf(`"%s": `, field.Name)
			// 	fmt.Printf("int(%d)", fieldValue.Interface())
			// 	fmt.Printf(",\n")
		}

	}
}

func TestSnowplowTransform(t *testing.T) {
	var GeoDB *geoip.GeoIP
	var err error
	GeoDB, err = geoip.Open("GeoLiteCity.dat")
	if err != nil {
		panic("Can't open GeoLiteCity.dat")
	}
	for _, testCase := range transformResultsSnowplow {
		event := &SnowplowEvent{}
		event.Transform([]byte(testCase.request), GeoDB)
		eventValues := reflect.ValueOf(event).Elem()
		eventTypes := reflect.TypeOf(*event)
		for fieldName, expectedValue := range testCase.expected {
			fieldType, exist := eventTypes.FieldByName(fieldName)
			if !exist {
				t.Errorf("Falied on: %s\nField name: %s not exist", testCase.title, fieldName)
				continue
			}
			fieldValue := eventValues.FieldByName(fieldType.Name).Interface()
			if fieldValue != expectedValue {
				t.Errorf("Falied on: %s[%s]\nFieldValue[%T]: %+v\nExpectedValue[%T]: %+v\n\n", testCase.title, fieldName, fieldValue, fieldValue, expectedValue, expectedValue)
			}
		}
	}
}

func PrintSnowplow(t *testing.T) {
	var GeoDB *geoip.GeoIP
	var err error
	GeoDB, err = geoip.Open("../GeoLiteCity.dat")
	if err != nil {
		panic("Can't open GeoLiteCity.dat")
	}
	for i, snowplowString := range snowplowStrings {
		event := &SnowplowEvent{}
		event.Transform([]byte(snowplowString), GeoDB)
		fmt.Printf("\n{\n`Test %d`,\n", i)
		fmt.Printf("`%s`,\n", snowplowString)
		event.PrintStatement()
		fmt.Printf("},\n},")
	}

}
